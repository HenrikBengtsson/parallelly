<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Checks if a Connection is Valid — isConnectionValid • parallelly</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Checks if a Connection is Valid — isConnectionValid" />
<meta property="og:description" content="Get a unique identifier for an R connection
and check whether or not the connection is still valid." />
<meta property="og:image" content="https://parallelly.futureverse.org/logo.png" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SB3EQSD9FR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB3EQSD9FR');
</script>


<!-- dependencies from examples -->


  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">parallelly</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.24.0-9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.futureverse.org/">
    <span class="fas fa-fast-backward"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://BiocParallel.FutureParam.futureverse.org">BiocParallel.FutureParam</a>
    </li>
    <li>
      <a href="https://doFuture.futureverse.org">doFuture</a>
    </li>
    <li>
      <a href="https://furrr.futureverse.org">furrr</a>
    </li>
    <li>
      <a href="https://future.futureverse.org">future</a>
    </li>
    <li>
      <a href="https://future.apply.futureverse.org">future.apply</a>
    </li>
    <li>
      <a href="https://future.batchtools.futureverse.org">future.batchtools</a>
    </li>
    <li>
      <a href="https://future.callr.futureverse.org">future.callr</a>
    </li>
    <li>
      <a href="https://future.tests.futureverse.org">future.tests</a>
    </li>
    <li>
      <a href="https://globals.futureverse.org">globals</a>
    </li>
    <li>
      <a href="https://listenv.futureverse.org">listenv</a>
    </li>
    <li>
      <a href="https://parallelly.futureverse.org">parallelly</a>
    </li>
    <li>
      <a href="https://progressr.futureverse.org">progressr</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://cloud.r-project.org/package=parallelly">
    <span class="fab fa-r-project"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/HenrikBengtsson/parallelly/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Checks if a Connection is Valid</h1>
    <small class="dont-index">Source: <a href='https://github.com/HenrikBengtsson/parallelly/blob/master/R/isConnectionValid.R'><code>R/isConnectionValid.R</code></a></small>
    <div class="hidden name"><code>isConnectionValid.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Get a unique identifier for an R <a href='https://rdrr.io/r/base/connections.html'>connection</a>
and check whether or not the connection is still valid.</p>
    </div>

    <pre class="usage"><span class='fu'>isConnectionValid</span><span class='op'>(</span><span class='va'>con</span><span class='op'>)</span>

<span class='fu'>connectionId</span><span class='op'>(</span><span class='va'>con</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>con</th>
      <td><p>A <a href='https://rdrr.io/r/base/connections.html'>connection</a>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>isConnectionValid()</code> returns TRUE if the connection is still valid,
otherwise FALSE.  If FALSE, then character attribute <code>reason</code> provides
an explanation why the connection is not valid.</p>
<p><code>connectionId()</code> returns an non-negative integer, -1, or <code>NA_integer_</code>.
For connections stdin, stdout, and stderr, 0, 1, and 2, are returned,
respectively.  For all other connections, an integer greater or equal to
3 based on the connection's internal pointer is returned.
A connection that has been serialized, which is no longer valid, has
identifier -1.
Attribute <code>raw_id</code> returns the pointer string from which the above is
inferred.</p>
    <h2 class="hasAnchor" id="connection-index-versus-connection-identifier"><a class="anchor" href="#connection-index-versus-connection-identifier"></a>Connection Index versus Connection Identifier</h2>

    

<p>R represents <a href='https://rdrr.io/r/base/connections.html'>connections</a> as indices using plain
integers, e.g. <code>idx &lt;- as.integer(con)</code>.
The three connections standard input ("stdin"), standard output ("stdout"),
and standard error ("stderr") always exists and have indices 0, 1, and 2.
Any connection opened beyond these will get index three or greater,
depending on availability as given by <code><a href='https://rdrr.io/r/base/showConnections.html'>base::showConnections()</a></code>.
To get the connection with a given index, use <code><a href='https://rdrr.io/r/base/showConnections.html'>base::getConnection()</a></code>.
<strong>Unfortunately, this index representation of connections is non-robust</strong>,
e.g. there are cases where two or more 'connection' objects can end up with
the same index and if used, the written output may end up at the wrong
destination and files and database might get corrupted.  This can for
instance happen if <code><a href='https://rdrr.io/r/base/showConnections.html'>base::closeAllConnections()</a></code> is used (*).
<strong>In contrast, <code>id &lt;- connectionId(con)</code> gives an identifier that is unique
to that 'connection' object.</strong>  This identifier is based on the internal
pointer address of the object.  The risk for two connections in the same
<span style="R">R</span> session to end up with the same pointer address is very small.
Thus, in case we ended up in a situation where two connections <code>con1</code> and
<code>con2</code> share the same index - <code>as.integer(con1) == as.integer(con2)</code> -
they will never share the same identifier -
<code>connectionId(con1) != connectionId(con2)</code>.
Here, <code>isConnectionValid()</code> can be used to check which one of these
connections, if any, are valid.</p>
<p>(*) Note that there is no good reason for calling <code><a href='https://rdrr.io/r/base/showConnections.html'>closeAllConnections()</a></code>
If called, there is a great risk that the files get corrupted etc.
See (1) for examples and details on this problem.
If you think there is a need to use it, it is much safer to restart <span style="R">R</span>
because that is guaranteed to give you a working <span style="R">R</span> session with
non-clashing connections.
It might also be that <code><a href='https://rdrr.io/r/base/showConnections.html'>closeAllConnections()</a></code> is used because
<code><a href='https://rdrr.io/r/base/base-internal.html'>base::sys.save.image()</a></code> is called, which might happen if <span style="R">R</span> is being
forced to terminate.</p>
    <h2 class="hasAnchor" id="connections-cannot-be-serialized-or-saved"><a class="anchor" href="#connections-cannot-be-serialized-or-saved"></a>Connections Cannot be Serialized Or Saved</h2>

    

<p>A 'connection' cannot be serialized, e.g. it cannot be saved to file to
be read and used in another <span style="R">R</span> session.  If attempted, the connection will
not be valid.  This is a problem that may occur in parallel processing
when passing an <span style="R">R</span> object to parallel worker for further processing, e.g.
the exported object may hold an internal database connection which will
no longer be valid on the worker.
When a connection is serialized, its internal pointer address will be
invalidated (set to nil). In such cases, <code>connectionId(con)</code> returns -1
and <code>isConnectionValid(con)</code> returns FALSE.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ol>
<li><p><a href='https://github.com/HenrikBengtsson/Wishlist-for-R/issues/81'>'BUG: A <code>connection</code> object may become corrupt and re-referenced to another connection (PATCH)'</a>, 2018-10-30.</p></li>
<li><p>R-devel thread <a href='https://stat.ethz.ch/pipermail/r-devel/2018-October/077004.html'>PATCH: Asserting that 'connection' used has not changed + R_GetConnection2()</a>, 2018-10-31.</p></li>
</ol>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>See <code><a href='https://rdrr.io/r/base/showConnections.html'>base::showConnections()</a></code> for currently open connections and their
indices. To get a connection by its index, use <code><a href='https://rdrr.io/r/base/showConnections.html'>base::getConnection()</a></code>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## R represents connections as plain indices</span>
<span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/showConnections.html'>stdin</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>          <span class='co'>## int 0</span>
</div><div class='output co'>#&gt; [1] 0</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/showConnections.html'>stdout</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>         <span class='co'>## int 1</span>
</div><div class='output co'>#&gt; [1] 3</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/showConnections.html'>stderr</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>         <span class='co'>## int 2</span>
</div><div class='output co'>#&gt; [1] 2</div><div class='input'>
<span class='co'>## The first three connections always exist and are always valid</span>
<span class='fu'>isConnectionValid</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/showConnections.html'>stdin</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>   <span class='co'>## TRUE</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='fu'>connectionId</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/showConnections.html'>stdin</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>        <span class='co'>## 0L</span>
</div><div class='output co'>#&gt; [1] 0</div><div class='input'><span class='fu'>isConnectionValid</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/showConnections.html'>stdout</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'>## TRUE</span>
</div><div class='output co'>#&gt; [1] FALSE
#&gt; attr(,"reason")
#&gt; [1] "Connection (connection: index=3, description=\"output\", class=\"textConnection\", mode=\"wr\", text=\"text\", opened=\"opened\", can read=\"no\", can write=\"yes\", id=NA) is no longer valid. It differ from the currently registered R connection with the same index 3 (connection: index=3, description=\"output\", class=\"textConnection\", mode=\"wr\", text=\"text\", opened=\"opened\", can read=\"no\", can write=\"yes\", id=1720, raw_id=\"&lt;pointer: 0x6b8&gt;\")"</div><div class='input'><span class='fu'>connectionId</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/showConnections.html'>stdout</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>       <span class='co'>## 1L</span>
</div><div class='output co'>#&gt; [1] NA</div><div class='input'><span class='fu'>isConnectionValid</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/showConnections.html'>stderr</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'>## TRUE</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='fu'>connectionId</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/showConnections.html'>stderr</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>       <span class='co'>## 2L</span>
</div><div class='output co'>#&gt; [1] 2</div><div class='input'>
<span class='co'>## Connections cannot be serialized</span>
<span class='va'>con</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>file</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span><span class='op'>(</span><span class='op'>)</span>, open <span class='op'>=</span> <span class='st'>"w"</span><span class='op'>)</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>value <span class='op'>=</span> <span class='fl'>42</span>, stderr <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/showConnections.html'>stderr</a></span><span class='op'>(</span><span class='op'>)</span>, con <span class='op'>=</span> <span class='va'>con</span><span class='op'>)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/serialize.html'>unserialize</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/serialize.html'>serialize</a></span><span class='op'>(</span><span class='va'>x</span>, connection <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>isConnectionValid</span><span class='op'>(</span><span class='va'>y</span><span class='op'>$</span><span class='va'>stderr</span><span class='op'>)</span>  <span class='co'>## TRUE</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='fu'>connectionId</span><span class='op'>(</span><span class='va'>y</span><span class='op'>$</span><span class='va'>stderr</span><span class='op'>)</span>       <span class='co'>##  2L</span>
</div><div class='output co'>#&gt; [1] 2</div><div class='input'><span class='fu'>isConnectionValid</span><span class='op'>(</span><span class='va'>y</span><span class='op'>$</span><span class='va'>con</span><span class='op'>)</span>     <span class='co'>## FALSE with attribute 'reason'</span>
</div><div class='output co'>#&gt; [1] FALSE
#&gt; attr(,"reason")
#&gt; [1] "Connection (connection: index=4, description=\"/tmp/hb/RtmpCy2VM1/file2bd5aebe4d\", class=\"file\", mode=\"w\", text=\"text\", opened=\"opened\", can read=\"no\", can write=\"yes\", id=-1) is no longer valid. It differ from the currently registered R connection with the same index 4 (connection: index=4, description=\"/tmp/hb/RtmpCy2VM1/file2bd5aebe4d\", class=\"file\", mode=\"w\", text=\"text\", opened=\"opened\", can read=\"no\", can write=\"yes\", id=1726, raw_id=\"&lt;pointer: 0x6be&gt;\")"</div><div class='input'><span class='fu'>connectionId</span><span class='op'>(</span><span class='va'>y</span><span class='op'>$</span><span class='va'>con</span><span class='op'>)</span>          <span class='co'>## -1L</span>
</div><div class='output co'>#&gt; [1] -1</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>con</span><span class='op'>)</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Henrik Bengtsson.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p> and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9001.</p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


